function startUserMedia(n){var t=audio_context.createMediaStreamSource(n);recorder=new Recorder(t)}function toggleRecord(n){$(".recognition-result").addClass("hidden");$("#success-recognition").text("");$(n).data("recording")?(recorder&&recorder.stop(),uploadAudioData(n),recorder.clear()):(recorder&&recorder.record(),$(n).find("span").text("Stop recording"),$(n).addClass("active"),$(n).data("recording",!0))}function uploadAudioData(n){$(n).find("span").text("");$(n).find("i").removeClass("hidden");recorder&&recorder.exportWAV(function(t){var i=new FormData;i.append("data",t);$.ajax({type:"POST",url:"/voice",data:i,beforeSend:function(n){n.setRequestHeader("XSRF-TOKEN",$('input:hidden[name="__RequestVerificationToken"]').val())},contentType:!1,processData:!1,success:function(t){var i=JSON.parse(t);i.RecognitionStatus=="Success"?($("#success-recognition").text(i.DisplayText),$("#success-recognition").removeClass("hidden")):$("#fail-recognition").removeClass("hidden");$(n).find("i").addClass("hidden");$(n).removeClass("active");$(n).find("span").text("Start recording");$(n).data("recording",!1)},failure:function(n){alert(n)}})})}var audio_context,recorder;$(window).load(function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia;window.URL=window.URL||window.webkitURL;audio_context=new AudioContext}catch(n){alert("No web audio support in this browser!")}navigator.getUserMedia({audio:!0},startUserMedia,function(){})});